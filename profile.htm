<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <title>NorthPoll | Profile</title>
</head>
<ul>
    <li><a href="index.htm">Home</a></li>
    <li><a href="post.htm">Post</a></li>
    <li><a href="contact.htm">Contact</a></li>
    <li style="float:right;" id="buttonLogout"><a href="#logging-out">Log Out</a></li>
    <li style="float:right;" id="myProfile"><a href="profile.htm">My Profile</a></li>
</ul>

<body>
    <div class="spacer-title">
    </div>
    <div class="">
        <center>
            <div class="black-box smallh smallw">
                <h3 style="color: white;" id="emailName"></h3>
        </center>
    </div>

    <!--Javascript reference-->

    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-database.js"></script>
    <script src="auth.js"></script>
    <script>
        let postVal;
        let isSameEmail;
        let x2;
        firebase.database().ref('users/' + 'totalCount/').on('value', function (snapshot) {
            postVal = snapshot.val();
        });

        document.getElementById("emailName").innerHTML = localStorage.getItem('emailCurrent');

        postVal = JSON.stringify(postVal);
        postVal = parseInt(postVal);
        console.log(postVal);

        function enterPosts() {
            if (postVal != NaN) {
                for (let index = 0; index <= postVal; index++) {
                    var testRef = firebase.database().ref('userIDs/' + localStorage.getItem('idCurrent') + "/");
                    testRef.on('value', function (snapshot) {
                        if (snapshot.hasChild(index + '/')) {
                        createCard(index, localStorage.getItem("emailCurrent"));
                    }
                    });
                }
                console.log('10 seconds ended');
            }
        }

        console.log("Start Count");
        setTimeout(() => { enterPosts() }, 10000);

        function returnQ(id, element) {
            var testRef = firebase.database().ref('userIDs/' + localStorage.getItem('idCurrent') + '/' + id + '/' + 'content');
            testRef.on('value', function (snapshot) {
                element.innerText = JSON.stringify(snapshot.val()).slice(1, -1);
                console.log(element.innerText);
            });
        }

        function returnOp1(id, element) {
            var testRef = firebase.database().ref('userIDs/' + localStorage.getItem('idCurrent') + '/' + id + '/' + 'op1/' + 'text');
            testRef.on('value', function (snapshot) {
                element.innerText = JSON.stringify(snapshot.val()).slice(1, -1);
            });
        }

        function returnOp2(id, element) {
            var testRef = firebase.database().ref('userIDs/' + localStorage.getItem('idCurrent') + '/' + id + '/' + 'op2/' + 'text');
            testRef.on('value', function (snapshot) {
                element.innerText = JSON.stringify(snapshot.val()).slice(1, -1);
            });
        }

        function returnOp3(id, element) {
            var testRef = firebase.database().ref('userIDs/' + localStorage.getItem('idCurrent') + '/' + id + '/' + 'op3/' + 'text');
            testRef.on('value', function (snapshot) {
                element.innerText = JSON.stringify(snapshot.val()).slice(1, -1);
            });
        }

        function returnOp4(id, element) {
            var testRef = firebase.database().ref('userIDs/' + localStorage.getItem('idCurrent') + '/' + id + '/' + 'op4/' + 'text');
            testRef.on('value', function (snapshot) {
                element.innerText = JSON.stringify(snapshot.val()).slice(1, -1);
            });
        }

        function returnBy(id, element) {
            var testRef = firebase.database().ref('userIDs/' + localStorage.getItem('idCurrent') + '/' + id + '/' + 'email');
            testRef.on('value', function (snapshot) {
                element.innerText = 'By: ' + JSON.stringify(snapshot.val()).slice(1, -1);
                console.log(element.innerHTML)
            });
        }

        function createCard(cardId, mana) {
            var spacer = document.createElement('div');
            spacer.setAttribute('class', 'spacer-main');
            var center = document.createElement("center");
            spacer.appendChild(center);
            var black_box = document.createElement('div');
            center.appendChild(black_box);
            black_box.setAttribute('class', 'black-card');
            black_box.setAttribute('style', 'color: white;');
            var header = document.createElement('h3');
            returnQ(cardId, header)
            header.setAttribute('style', 'color: white;')
            black_box.appendChild(header);
            var br1 = document.createElement('br');
            black_box.appendChild(br1);
            var br2 = document.createElement('br');
            black_box.appendChild(br2);
            var option1 = document.createElement('button');
            returnOp1(cardId, option1)
            black_box.appendChild(option1);
            option1.setAttribute('class', 'register-button')
            var option2 = document.createElement('button');
            returnOp2(cardId, option2)
            black_box.appendChild(option2);
            option2.setAttribute('class', 'register-button')
            var option3 = document.createElement('button');
            returnOp3(cardId, option3)
            black_box.appendChild(option3);
            option3.setAttribute('class', 'register-button')
            var option4 = document.createElement('button');
            returnOp4(cardId, option4)
            black_box.appendChild(option4);
            option4.setAttribute('class', 'register-button');
            var byText = document.createElement('p');
            returnBy(cardId, byText);
            black_box.appendChild(byText);
            byText.setAttribute('style', 'text-align: center;');
            document.body.appendChild(spacer);
        }
    </script>
</body>

</html>